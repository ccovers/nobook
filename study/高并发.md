# 高并发

## 什么是高并发
1. 高并发(High Concurrency)是互联网分布式系统架构设计中必须考虑的因素之一。它通常是指，通过设计保证系统能够同时并行处理很多请求。
2. 高并发相关常用的一些指标有：
	- 响应时间(Response Time)： 系统对请求做出的响应时间。例如系统处理一个HTTP请求需要200ms，这个200ms就是系统的响应时间。
	- 吞吐量(Throughput)： 单位时间内处理的请求数。
	- 每秒查询率`QPS`(Query Per Second)： 每秒响应请求数。在互联网领域，这个指标和吞吐量的区分没有那么明显。
	- 并发用户数： 同时承载正常使用系统功能的用户数量。例如一个通讯系统，同时在线量一定程度代表了系统的并发用户数。

## 如何提升系统的并发能力
互联网分布式架构设计，提高系统并发能力的方式，方法论上主要有两种：垂直扩展(Scale Up)与水平扩展(Scale Out)。
1. 垂直扩展：提升单机处理能力。垂直扩展的方式有两种。
	- 增强单机硬件性能，例如：增加CPU核心如32核，升级更好的网卡如万兆，升级更好的硬盘如SSD，扩充硬盘容量如2T，扩充系统内存如128G；
	- 提升单机架构性能，例如：使用Cache来减少IO次数，使用异步来增加但服务吞吐量，使用无锁数据结构来减少响应时间；
	（无论是提升单机硬件性能还是提升单机架构性能，都有一个致命的不足：单机性能总是有极限的。所以互联网分布式架构设计高并发终极解决方案还是水平扩展）
2. 水平扩展：只要只能加服务器数量，就能线性扩充系统性能。（水平扩展对系统架构设计有要求）


## 常见互联网分布式架构如上，分为：
1. 客户端层：典型调用方是浏览器 browser 或者手机应用 APP
2. 反向代理层：系统入口，反向代理。
3. 站点应用层：实现核心应用逻辑，返回 html 或者 json。
4. 服务层：如果实现了服务化，就有这一层。
5. 数据-缓存层：缓存加速访问存储。
6. 数据-数据库层：数据库固化数据存储。

## 互联网分层架构中，各层次水平扩展的实践又有所不同：
1. 反向代理层可以通过“DNS 轮询”的方式来进行水平扩展；
2. 站点层可以通过 nginx 来进行水平扩展；
3. 服务层可以通过服务连接池来进行水平扩展；
4. 数据库可以按照数据范围，或者数据哈希的方式来进行水平扩展；
	各层实施水平扩展后，能够通过增加服务器数量的方式来提升系统的性能，做到理论上的性 能无限。 

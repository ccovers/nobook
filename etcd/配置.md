# 配置

## 启动参数解释
```
# etcd集群中的节点名，这里可以随意，可区分且不重复就行
ETCD_NAME=node-1

# ETCD存储目录
ETCD_DATA_DIR="/usr/local/etcd/data"

# 对外公告的该节点客户端监听地址，这个值会告诉集群中其他节点
ETCD_LISTEN_CLIENT_URLS="http://0.0.0.0:2379,http://127.0.0.1:2379"
# 监听的用于节点之间通信的url，可监听多个，集群内部将通过这些url进行数据交互(如选举，数据同步等)
ETCD_LISTEN_PEER_URLS="http://localhost:2380"

# 初始化名称，集群的 token，集群唯一。如果要重新创建集群，即使配置和之前一样，也会再次生成新的集群和节点 uuid；否则会导致多个集群之间的冲突，造成未知的错误
ETCD_INITIAL_CLUSTER_TOKEN="etcd-cluster-token"

# 初始化群集列表，集群中所有节点的信息
ETCD_INITIAL_CLUSTER="node-1=http://192.168.100.101:2380,node-2=http://192.168.100.102:2380,node-3=http://192.168.100.103:2380"

# 初始化状态
ETCD_INITIAL_CLUSTER_STATE=new


```

- initial-advertise-peer-urls: 建议用于节点之间通信的url，节点间将以该值进行通信。
- listen-client-urls: 监听的用于客户端通信的url,同样可以监听多个。
- advertise-client-urls: 建议使用的客户端通信url,该值用于etcd代理或etcd成员与etcd节点通信。



## 搭建集群
### Etcd构建自身高可用集群主要有三种形式:
- 静态发现: 预先已知 Etcd 集群中有哪些节点，在启动时直接指定好Etcd的各个node节点地址
- Etcd动态发现: 通过已有的Etcd集群作为数据交互点，然后在扩展新的集群时实现通过已有集群进行服务发现的机制
- DNS动态发现: 通过DNS查询方式获取其他节点地址信息

### 采用Static方式，准备三台机器，ip如下(都已经安装etcd)
node1 192.168.100.101
node2 192.168.100.102
node3 192.168.100.103

### 进入node，创建并运行run.sh,脚本内容如下
```
#!/usr/bin/env bash
#节点名称 （唯一）
ETCD_NAME=node-1
#本机IP地址 （唯一）
LOCAL_IP=192.168.100.101
#ETCD存储目录
ETCD_DATA_DIR=/usr/local/etcd/data
#初始化名称
INITIAL_CLUSTER_TOKEN=cqh-test-cluster
#初始化群集列表
INITIAL_CLUSTER="node-1=http://192.168.100.101:2380,node-2=http://192.168.100.102:2380,node-3=http://192.168.100.103:2380"
#初始化状态
INITIAL_CLUSTER_STATE=new

#开始运行
etcd --name ${ETCD_NAME} --data-dir ${ETCD_DATA_DIR} \
    --initial-advertise-peer-urls http://${LOCAL_IP}:2380 \
    --listen-peer-urls http://${LOCAL_IP}:2380 \
    --listen-client-urls http://${LOCAL_IP}:2379,http://127.0.0.1:2379 \
    --advertise-client-urls http://${LOCAL_IP}:2379 \
    --initial-cluster-token ${INITIAL_CLUSTER_TOKEN} \
    --initial-cluster ${INITIAL_CLUSTER} \
    --initial-cluster-state ${INITIAL_CLUSTER_STATE}
```


